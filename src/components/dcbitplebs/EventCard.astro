---
import { Icon } from 'astro-icon/components';
import type { DCBitPlebsEvent } from '~/types';
import { getPermalink } from '~/utils/permalinks';
import { getFormattedDate } from '~/utils/utils';
import EventPreviewModal from './EventPreviewModal.astro';

export interface Props {
  event: DCBitPlebsEvent;
  isFeatured?: boolean;
}

const { event, isFeatured = false } = Astro.props;
const link = getPermalink(`dcbitplebs/${event.slug}`);
const modalId = `event-${event.slug}`;
---

{isFeatured ? (
  <!-- Featured Event Card (Larger) -->
  <article class="max-w-md mx-auto border border-gray-200 dark:border-slate-700 rounded-lg p-6 hover:shadow-lg transition-shadow">
    <header class="mb-4">
      <h2 class="text-xl sm:text-2xl font-bold leading-tight mb-2 font-heading dark:text-slate-300">
        <a
          class="hover:text-primary dark:hover:text-blue-400 transition ease-in duration-200"
          href={link}
        >
          DC BitPlebs #{event.eventNumber}
        </a>
      </h2>
      <p class="text-sm text-muted dark:text-slate-400">
        <Icon name="tabler:calendar" class="w-3.5 h-3.5 inline-block -mt-0.5" />
        <time datetime={event.date.toISOString()} class="inline-block ml-1">{getFormattedDate(event.date)}</time>
        {' '}
        · <Icon name="tabler:clock" class="w-3.5 h-3.5 inline-block -mt-0.5 ml-1" />
        <span class="inline-block ml-1">{event.time}</span>
      </p>
    </header>

    <div class="space-y-2">
      <div class="flex items-start">
        <Icon name="tabler:map-pin" class="w-4 h-4 mt-0.5 mr-2 text-muted dark:text-slate-400 flex-shrink-0" />
        <div>
          <p class="font-semibold text-sm dark:text-slate-300">{event.venue}</p>
          <p class="text-sm text-muted dark:text-slate-400">{event.address}</p>
        </div>
      </div>
    </div>

    <footer class="mt-4 flex items-center gap-3">
      <button
        type="button"
        data-modal-open={`event-preview-${modalId}`}
        class="inline-flex items-center text-primary dark:text-blue-400 hover:underline text-sm font-medium"
      >
        <Icon name="tabler:eye" class="w-4 h-4 mr-1" />
        Preview
      </button>
      <a
        href={link}
        class="inline-flex items-center text-primary dark:text-blue-400 hover:underline text-sm font-medium"
      >
        View Agenda
        <Icon name="tabler:arrow-right" class="w-4 h-4 ml-1" />
      </a>
    </footer>
  </article>
) : (
  <!-- Condensed Event Card (Smaller, Vertical) -->
  <article class="max-w-2xl mx-auto border border-gray-200 dark:border-slate-700 rounded-lg p-4 hover:shadow-md transition-shadow">
    <div class="flex items-center justify-between gap-4">
      <div class="flex-1 min-w-0 flex items-center gap-3 text-sm">
        <h2 class="font-bold font-heading dark:text-slate-300">
          <a
            class="hover:text-primary dark:hover:text-blue-400 transition ease-in duration-200"
            href={link}
          >
            DC BitPlebs #{event.eventNumber}
          </a>
        </h2>
        <span class="text-muted dark:text-slate-400">·</span>
        <span class="flex items-center text-xs text-muted dark:text-slate-400">
          <Icon name="tabler:calendar" class="w-3 h-3 mr-1" />
          <time datetime={event.date.toISOString()}>{getFormattedDate(event.date)}</time>
        </span>
        <span class="flex items-center text-xs text-muted dark:text-slate-400">
          <Icon name="tabler:clock" class="w-3 h-3 mr-1" />
          {event.time}
        </span>
        <span class="flex items-center text-xs text-muted dark:text-slate-400 truncate">
          <Icon name="tabler:map-pin" class="w-3 h-3 mr-1 flex-shrink-0" />
          <span class="truncate">{event.venue}</span>
        </span>
      </div>
      <div class="flex items-center gap-2 flex-shrink-0">
        <button
          type="button"
          data-modal-open={`event-preview-${modalId}`}
          class="inline-flex items-center p-2 text-primary dark:text-blue-400 hover:bg-gray-100 dark:hover:bg-slate-800 rounded transition-colors"
          title="Preview agenda"
        >
          <Icon name="tabler:eye" class="w-4 h-4" />
        </button>
        <a
          href={link}
          class="inline-flex items-center text-primary dark:text-blue-400 hover:underline"
          title="View full agenda"
        >
          <Icon name="tabler:arrow-right" class="w-4 h-4" />
        </a>
      </div>
    </div>
  </article>
)}

<EventPreviewModal event={event} id={modalId} />

